# pip-tools = pip-compile + pip-sync

[ğŸ”—Githubä»“åº“](https://github.com/jazzband/pip-tools)

![overview](https://github.com/jazzband/pip-tools/raw/master/img/pip-tools-overview.svg)

## å®‰è£…

```bash
$ source /path/to/venv/bin/activate
(venv) $ pip install pip-tools
```

## pip-compile

### æ‰§è¡Œ`pip-compile`

```bash
$ pip-compile
$ python -m pip-tools compile
$ pythonX.Y -m piptools compile # å¤šç‰ˆæœ¬å…±å­˜çš„æ—¶å€™ä½¿ç”¨
```

### ç¼–è¯‘æºæ–‡ä»¶ä¹‹`setup.py`

[ğŸ”—å‚è€ƒé“¾æ¥: pythonã®setup.pyã«ã¤ã„ã¦ã¾ã¨ã‚ã‚‹](https://qiita.com/Tadahiro_Yamamura/items/2cbcd272a96bb3761cc8)
[ğŸ”—å‚è€ƒé“¾æ¥: ç¼–å†™setup.py](https://packaging.python.org/en/latest/guides/distributing-packages-using-setuptools/#configuring-your-project)

å¦‚æœç›®å½•ä¸‹å­˜åœ¨`setup.py`ï¼Œåˆ™ä¼šè‡ªåŠ¨ç¼–è¯‘ã€‚
ä»¥`install_requires=['django']`ä¸ºä¾‹:

```bash
$ pip-compile
#
# This file is autogenerated by pip-compile with python 3.10
# To update, run:
#
#    pip-compile requirements.in
#
asgiref==3.4.1
    # via django
django==4.0
    # via -r requirements.in
sqlparse==0.4.2
    # via django
```

### ç¼–è¯‘æºæ–‡ä»¶ä¹‹`requirements.in`

```ini
# requirements.in
django
```

æ‰§è¡Œ`pip-compile requirements.in`å:

```bash
$ pip-compile requirements.in
#
# This file is autogenerated by pip-compile with python 3.10
# To update, run:
#
#    pip-compile requirements.in
#
asgiref==3.4.1
    # via django
django==4.0
    # via -r requirements.in
sqlparse==0.4.2
    # via django
```

### æ›´æ–°ç¼–è¯‘ç»“æœ

ğŸ“¢æ³¨æ„ï¼š
`pip-compile`å¦‚æœæ£€æµ‹åˆ°`requirements.txt`å·²ç»æ»¡è¶³`pip-compile`çš„è¦æ±‚ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚  
å¦‚æœæƒ³è¦é‡æ–°ç”Ÿæˆ`requirements.txt`ï¼Œéœ€è¦ä½¿ç”¨`pip-compile --upgrade`ã€‚

```bash
# only update the django package
$ pip-compile --upgrade-package django

# update both the django and requests packages
$ pip-compile --upgrade-package django --upgrade-package requests

# update the django package to the latest, and requests to v2.0.0
$ pip-compile --upgrade-package django --upgrade-package requests==2.0.0
```

Tips: å¯ä»¥ç»„åˆä½¿ç”¨`--upgrade`å’Œ`--upgrade-package`æ¥é™åˆ¶`pip-compile`åªæ›´æ–°æŒ‡å®šçš„åŒ…ã€‚

```bash
$ pip-compile --upgrade --upgrade-package 'requests<3.0'
```

### ä½¿ç”¨hashå€¼

[ğŸ”—pipçš„Hash Checking Mode](https://pip.pypa.io/en/stable/cli/pip_install/#hash-checking-mode)

```bash
$ pip-compile --generate-hashes requirements.in
#
# This file is autogenerated by pip-compile with python 3.10
# To update, run:
#
#    pip-compile --generate-hashes requirements.in
#
asgiref==3.4.1 \
    --hash=sha256:4ef1ab46b484e3c706329cedeff284a5d40824200638503f5768edb6de7d58e9 \
    --hash=sha256:ffc141aa908e6f175673e7b1b3b7af4fdb0ecb738fc5c8b88f69f055c2415214
    # via django
django==4.0 \
    --hash=sha256:59304646ebc6a77b9b6a59adc67d51ecb03c5e3d63ed1f14c909cdfda84e8010 \
    --hash=sha256:d5a8a14da819a8b9237ee4d8c78dfe056ff6e8a7511987be627192225113ee75
    # via -r requirements.in
sqlparse==0.4.2 \
    --hash=sha256:0c00730c74263a94e5a9919ade150dfc3b19c574389985446148402998287dae \
    --hash=sha256:48719e356bb8b42991bdbb1e8b83223757b93789c00910a616a071910ca4a64d
    # via django
```

### æŒ‡å®šè¾“å‡ºæ–‡ä»¶

é»˜è®¤çš„è¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶åå’Œæºæ–‡ä»¶ç›¸åŒ,åªæ˜¯æ–‡ä»¶åç¼€ç”±`.in`å˜ä¸º`.txt`(å¦‚`requirements.in`å˜ä¸º`requirements.txt`)ã€‚  
å¦‚æœéœ€è¦æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨`--output-file`é€‰é¡¹ã€‚

```bash
$ pip-compile requirements.in --output-file requirements-django.txt
#
# This file is autogenerated by pip-compile with python 3.10
# To update, run:
#
#    pip-compile --output-file=requirements-django.txt requirements.in
#
asgiref==3.4.1
    # via django
django==4.0
    # via -r requirements.in
sqlparse==0.4.2
    # via django
```

å¯ä»¥ä½¿ç”¨`--output-file=-`æ¥å°†è¾“å‡ºæ–‡ä»¶å†™å…¥æ ‡å‡†è¾“å‡ºã€‚

```bash
$ pip-compile --output-file=- > requirements.txt
$ pip-compile - --output-file=- < requirements.in > requirements.txt
```

### ä½¿ç”¨`pip`çš„é€‰é¡¹

åœ¨ä½¿ç”¨`pip-compile`æ—¶,å¯ä»¥é€šè¿‡`--pip-args`é€‰é¡¹æ¥æŒ‡å®šä»»æ„åˆæ³•çš„`pip`é€‰é¡¹:

```bash
$ pip-compile requirements.in --pip-args '--retries 10 --timeout 30'
```

## pip-sync

### æ‰§è¡Œ`pip-sync`

```bash
$ pip-sync
$ python -m piptools sync
$ pythonX.Y -m piptools sync
```

```bash
$ pip-sync
Collecting asgiref==3.4.1
  Using cached asgiref-3.4.1-py3-none-any.whl (25 kB)
Collecting django==4.0
  Using cached Django-4.0-py3-none-any.whl (8.0 MB)
Collecting sqlparse==0.4.2
  Using cached sqlparse-0.4.2-py3-none-any.whl (42 kB)
Installing collected packages: sqlparse, asgiref, django
Successfully installed asgiref-3.4.1 django-4.0 sqlparse-0.4.2
```

### å¤šä¸ª`*.txt`æ–‡ä»¶

```bash
$ pip-sync dev-requirements.txt requirements.txt
```

â­ï¸å¦‚æœæ²¡æœ‰å‚æ•°ä¸ºç©º,é‚£ä¹ˆé»˜è®¤ä¼ å…¥`requirements.txt`.

### `pip`é€‰é¡¹

å’Œ`pip-compile`ä¸€æ ·,ä»»ä½•åˆæ³•çš„`pip`é€‰é¡¹éƒ½å¯ä»¥ä½¿ç”¨`--pip-args`é€‰é¡¹æ¥æŒ‡å®š:

```bash
$ pip-sync requirements.txt --pip-args '--no-cache-dir --no-deps'
```

## æ³¨æ„äº‹é¡¹

* åœ¨åšç‰ˆæœ¬ç®¡ç†æ—¶,åº”è¯¥æŠŠ`requirements.in`å’Œ`requirements.txt`éƒ½è¿›è¡Œç®¡ç†
